<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEAPP Reflection Report Builder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: #ecf0f1;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
        }
        
        .editor-section, .preview-section, .commands-section {
            padding: 20px;
        }
        
        .editor-section {
            flex: 1;
            min-width: 300px;
        }
        
        .preview-section {
            flex: 1.5;
            min-width: 400px;
            border-left: 1px solid #eee;
        }
        
        .commands-section {
            width: 100%;
            background-color: #f9f9f9;
            border-top: 1px solid #eee;
            margin-top: 20px;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #3498db;
            font-size: 1.5rem;
        }
        
        h3 {
            color: #34495e;
            margin: 15px 0 10px 0;
            font-size: 1.2rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        textarea {
            width: 100%;
            height: 150px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .word-count {
            text-align: right;
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .total-words {
            text-align: center;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .requirements-note {
            background-color: #e8f4fc;
            border-left: 4px solid #3498db;
            padding: 12px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
            font-size: 0.95rem;
        }
        
        .student-info {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .preview-container {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 25px;
            min-height: 700px;
            font-family: 'Times New Roman', Times, serif;
            font-size: 12pt;
            text-align: justify;
            line-height: 1.5;
        }
        
        .preview-container h1, 
        .preview-container h2, 
        .preview-container h3, 
        .preview-container h4, 
        .preview-container h5, 
        .preview-container h6 {
            font-family: 'Times New Roman', Times, serif;
            margin-top: 15px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .preview-container h1 {
            font-size: 18pt;
        }
        
        .preview-container h2 {
            font-size: 16pt;
        }
        
        .preview-container h3 {
            font-size: 14pt;
        }
        
        .preview-container ol, 
        .preview-container ul {
            padding-left: 30px;
            margin: 10px 0;
        }
        
        .preview-container li {
            margin-bottom: 5px;
        }
        
        .preview-container .tabbed {
            margin-left: 40px;
            text-indent: -20px;
            padding-left: 40px;
        }
        
        .preview-container strong {
            font-weight: bold;
        }
        
        .preview-container em {
            font-style: italic;
        }
        
        .preview-container blockquote {
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin: 15px 0;
            color: #555;
            font-style: italic;
        }
        
        .preview-container hr {
            border: none;
            border-top: 1px solid #ddd;
            margin: 20px 0;
        }
        
        .commands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .command-item {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .command-syntax {
            font-family: monospace;
            background-color: #f1f1f1;
            padding: 5px 10px;
            border-radius: 3px;
            margin: 8px 0;
            display: inline-block;
            border-left: 3px solid #3498db;
        }
        
        .command-example {
            font-size: 0.9rem;
            color: #555;
            margin-top: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        #clearBtn {
            background-color: #e74c3c;
        }
        
        #clearBtn:hover {
            background-color: #c0392b;
        }
        
        #exportBtn {
            background-color: #27ae60;
        }
        
        #exportBtn:hover {
            background-color: #219653;
        }
        
        #sampleBtn {
            background-color: #9b59b6;
        }
        
        #sampleBtn:hover {
            background-color: #8e44ad;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }
        
        .status-message {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .modal h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-close {
            background-color: #7f8c8d;
        }
        
        .modal-close:hover {
            background-color: #636e72;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .preview-section {
                border-left: none;
                border-top: 1px solid #eee;
            }
            
            .student-info {
                grid-template-columns: 1fr;
            }
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .word-count-status {
            font-weight: bold;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .good {
            color: #27ae60;
        }
        
        .low {
            color: #e74c3c;
        }
        
        .high {
            color: #f39c12;
        }
        
        .test-commands {
            background-color: #fff8e1;
            border: 1px solid #ffd54f;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .test-commands h4 {
            color: #f57c00;
            margin-bottom: 10px;
        }
        
        .command-test {
            font-family: monospace;
            background-color: #fffde7;
            padding: 8px;
            border-radius: 3px;
            margin: 5px 0;
            border-left: 3px solid #ffb300;
            font-size: 0.9rem;
        }
        
        .pdf-issue-note {
            background-color: #ffeaa7;
            border: 1px solid #fdcb6e;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        
        .issue-fixed {
            color: #27ae60;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>LEAPP Reflection Report Builder</h1>
            <p class="subtitle">Create your weekly LEAPP reflection reports following the required format: Learning, Equivalence & Awareness, Practice, and Personal Insight</p>
        </header>
        
        <div class="main-content">
            <div class="editor-section">
                <h2>Report Editor</h2>
                
                <div class="requirements-note">
                    <p><strong>Format Requirements:</strong> 300-400 words total, Times New Roman font, size 12, justified alignment. Submit as PDF.</p>
                    <p><strong>Academic Integrity:</strong> Plagiarism and unacknowledged AI-generated content are strictly prohibited.</p>
                </div>
                
                <div class="pdf-issue-note">
                    <p><strong>Issue Fixed:</strong> Previous PDF export had problems with commands appearing as text. Now commands are properly processed in PDF.</p>
                    <p><strong>[TAB] Command:</strong> Correctly indents the entire paragraph/sentence that follows.</p>
                </div>
                
                <div class="student-info">
                    <div class="form-group">
                        <label for="studentName">Student Name</label>
                        <input type="text" id="studentName" placeholder="Enter your full name">
                    </div>
                    
                    <div class="form-group">
                        <label for="course">Course & Section</label>
                        <input type="text" id="course" placeholder="e.g., BSCS 3">
                    </div>
                    
                    <div class="form-group">
                        <label for="subject">Subject</label>
                        <input type="text" id="subject" placeholder="e.g., Database Management">
                    </div>
                    
                    <div class="form-group">
                        <label for="weekNumber">Week Number</label>
                        <input type="text" id="weekNumber" placeholder="e.g., Week 5" value="Week 5">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="learning">1. LEARNING</label>
                    <textarea id="learning" placeholder="Explain what concepts, tools, or skills you learned this week in your own words..."></textarea>
                    <div class="word-count">Words: <span id="learningCount">0</span></div>
                </div>
                
                <div class="form-group">
                    <label for="equivalence">2. EQUIVALENCE & AWARENESS</label>
                    <textarea id="equivalence" placeholder="Connect the lesson to real-life situations, technology trends, or previous lessons..."></textarea>
                    <div class="word-count">Words: <span id="equivalenceCount">0</span></div>
                </div>
                
                <div class="form-group">
                    <label for="practice">3. PRACTICE</label>
                    <textarea id="practice" placeholder="Explain how the lesson can be applied in programming, system development, problem-solving, or future IT work..."></textarea>
                    <div class="word-count">Words: <span id="practiceCount">0</span></div>
                </div>
                
                <div class="form-group">
                    <label for="insight">4. PERSONAL INSIGHT</label>
                    <textarea id="insight" placeholder="Reflect on what you found challenging or confusing and what you learned about yourself as a student..."></textarea>
                    <div class="word-count">Words: <span id="insightCount">0</span></div>
                </div>
                
                <div class="total-words">
                    <p>Total Words: <span id="totalWordCount" class="word-count-status">0</span> / 300-400 required</p>
                </div>
                
                <div class="status-message" id="statusMessage"></div>
                
                <div class="loading" id="loadingIndicator">
                    <div class="loading-spinner"></div>
                    <p>Generating PDF...</p>
                </div>
                
                <div class="button-group">
                    <button id="previewBtn">Update Preview</button>
                    <button id="sampleBtn">Load Sample</button>
                    <button id="clearBtn">Clear All</button>
                    <button id="exportBtn">Export as PDF</button>
                </div>
                
                <div class="test-commands">
                    <h4>Test Commands (Copy and paste to test):</h4>
                    <div class="command-test">&lt;h3&gt;My Subheading&lt;/h3&gt;</div>
                    <div class="command-test">[TAB]This paragraph is indented using the custom command.</div>
                    <div class="command-test">This is &lt;b&gt;bold&lt;/b&gt; and &lt;i&gt;italic&lt;/i&gt;.</div>
                    <div class="command-test">&lt;ul&gt;&lt;li&gt;List Item 1&lt;/li&gt;&lt;li&gt;List Item 2&lt;/li&gt;&lt;/ul&gt;</div>
                </div>

            
            <div class="preview-section">
                <h2>Live Preview</h2>
                <div class="preview-container" id="preview">
                    <p style="color: #999; text-align: center; margin-top: 50px;">Your formatted report will appear here</p>
                </div>
            </div>
                        <div class="commands-section">
                <h2>Formatting Commands</h2>
                <p>You can now use standard HTML tags for formatting! We also kept the special <strong>[TAB]</strong> command for indentation.</p>
                
                <div class="commands-grid">
                    <div class="command-item">
                        <h3>Headers</h3>
                        <div class="command-syntax">&lt;h1&gt;Main Title&lt;/h1&gt;</div>
                        <div class="command-example">Creates a large header</div>
                        
                        <div class="command-syntax">&lt;h3&gt;Sub Header&lt;/h3&gt;</div>
                        <div class="command-example">Creates a sub header</div>
                    </div>
                    
                    <div class="command-item">
                        <h3>Text Emphasis</h3>
                        <div class="command-syntax">&lt;b&gt;Bold Text&lt;/b&gt;</div>
                        <div class="command-example">Makes text <b>bold</b></div>
                        
                        <div class="command-syntax">&lt;i&gt;Italic Text&lt;/i&gt;</div>
                        <div class="command-example">Makes text <i>italic</i></div>
                        
                        <div class="command-syntax">&lt;u&gt;Underline&lt;/u&gt;</div>
                        <div class="command-example">Makes text <u>underlined</u></div>
                    </div>
                    
                    <div class="command-item">
                        <h3>Lists</h3>
                        <div class="command-syntax">&lt;ul&gt;&lt;li&gt;Item&lt;/li&gt;&lt;/ul&gt;</div>
                        <div class="command-example">Creates a bulleted list</div>
                        
                        <div class="command-syntax">&lt;ol&gt;&lt;li&gt;Item&lt;/li&gt;&lt;/ol&gt;</div>
                        <div class="command-example">Creates a numbered list</div>
                    </div>
                    
                    <div class="command-item">
                        <h3>Special & Custom</h3>
                        <div class="command-syntax" style="background-color: #e8f4fc; border-color: #3498db;">[TAB]</div>
                        <div class="command-example"><strong>Custom:</strong> Indents the following text</div>
                        
                        <div class="command-syntax">&lt;br&gt;</div>
                        <div class="command-example">Force a line break</div>
                        
                        <div class="command-syntax">&lt;hr&gt;</div>
                        <div class="command-example">Horizontal line separator</div>
                    </div>
                </div>
            </div>

           
            </div>
        </div>
        
        <div class="footer">
            <p>LEAPP Reflection Report Builder | Based on Classroom Requirements | Total word count must be between 300-400 words</p>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <h3>Confirm PDF Export</h3>
            <p id="modalMessage">Your report is ready for export. Would you like to proceed?</p>
            <div class="modal-buttons">
                <button id="modalCancel" class="modal-close">Cancel</button>
                <button id="modalConfirm">Export PDF</button>
            </div>
        </div>
    </div>

       <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        // Get DOM elements
        const studentNameInput = document.getElementById('studentName');
        const courseInput = document.getElementById('course');
        const subjectInput = document.getElementById('subject');
        const weekNumberInput = document.getElementById('weekNumber');
        const learningTextarea = document.getElementById('learning');
        const equivalenceTextarea = document.getElementById('equivalence');
        const practiceTextarea = document.getElementById('practice');
        const insightTextarea = document.getElementById('insight');
        const previewDiv = document.getElementById('preview');
        const previewBtn = document.getElementById('previewBtn');
        const clearBtn = document.getElementById('clearBtn');
        const exportBtn = document.getElementById('exportBtn');
        const sampleBtn = document.getElementById('sampleBtn');
        const statusMessage = document.getElementById('statusMessage');
        const loadingIndicator = document.getElementById('loadingIndicator');
        
        // Modal elements
        const confirmationModal = document.getElementById('confirmationModal');
        const modalCancel = document.getElementById('modalCancel');
        const modalConfirm = document.getElementById('modalConfirm');
        const modalMessage = document.getElementById('modalMessage');
        
        // Word count elements
        const learningCount = document.getElementById('learningCount');
        const equivalenceCount = document.getElementById('equivalenceCount');
        const practiceCount = document.getElementById('practiceCount');
        const insightCount = document.getElementById('insightCount');
        const totalWordCount = document.getElementById('totalWordCount');
        
        // Function to count words in a string
        function countWords(text) {
            if (!text || text.trim() === '') return 0;
            // Remove HTML tags for accurate word count
            const cleanText = text.replace(/<[^>]*>/g, ' ');
            return cleanText.trim().split(/\s+/).length;
        }
        
        // Function to update word counts
        function updateWordCounts() {
            const learningWords = countWords(learningTextarea.value);
            const equivalenceWords = countWords(equivalenceTextarea.value);
            const practiceWords = countWords(practiceTextarea.value);
            const insightWords = countWords(insightTextarea.value);
            const totalWords = learningWords + equivalenceWords + practiceWords + insightWords;
            
            learningCount.textContent = learningWords;
            equivalenceCount.textContent = equivalenceWords;
            practiceCount.textContent = practiceWords;
            insightCount.textContent = insightWords;
            totalWordCount.textContent = totalWords;
            
            // Highlight if word count is not in range
            if (totalWords < 300) {
                totalWordCount.className = 'word-count-status low';
                totalWordCount.title = 'Word count is too low (minimum 300 words)';
            } else if (totalWords > 400) {
                totalWordCount.className = 'word-count-status high';
                totalWordCount.title = 'Word count is too high (maximum 400 words)';
            } else {
                totalWordCount.className = 'word-count-status good';
                totalWordCount.title = 'Word count is within the required range';
            }
            
            return totalWords;
        }
        
        // Function to show status message
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }
        
        // Function to parse and convert commands to HTML
        function parseCommands(text) {
            if (!text || text.trim() === '') return '';
            
            let result = text;
            
            // 1. Handle the Custom [TAB] command
            result = result.replace(/\[TAB\]/g, '<span style="display:inline-block; margin-left:40px;"></span>');

            // 2. Handle Newlines (convert to <br>)
            result = result.replace(/\n/g, '<br>');
            
            return result;
        }
        
        // Function to clean text for PDF (remove HTML tags but keep structure)
        function cleanTextForPDF(text) {
            if (!text || text.trim() === '') return '';
            
            let result = text;
            
            // 1. Handle Custom [TAB] for PDF (Replace with 4 spaces)
            result = result.replace(/\[TAB\]/g, '    ');
            
            // 2. Handle HTML Lists for PDF
            result = result.replace(/<li[^>]*>/gi, '\nâ€¢ ');
            
            // 3. Handle Block Breaks
            result = result.replace(/<br\s*\/?>/gi, '\n');
            result = result.replace(/<\/p>|<\/div>|<\/h[1-6]>/gi, '\n\n');
            result = result.replace(/<\/ul>|<\/ol>|<\/li>/gi, ''); 
            
            // 4. Strip all remaining HTML tags
            result = result.replace(/<[^>]*>/g, '');
            
            // 5. Decode basic HTML entities
            result = result.replace(/&nbsp;/g, ' ');
            result = result.replace(/&amp;/g, '&');
            result = result.replace(/&lt;/g, '<');
            result = result.replace(/&gt;/g, '>');
            
            return result.trim();
        }

        // Function to Generate Live Preview
        function generatePreview() {
            const date = new Date().toLocaleDateString();
            
            let html = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h1>LEAPP Reflection Report</h1>
                    <p style="margin-bottom: 5px;"><strong>Student Name:</strong> ${studentNameInput.value || '[Name]'}</p>
                    <p style="margin-bottom: 5px;"><strong>Course:</strong> ${courseInput.value || '[Course]'}</p>
                    <p style="margin-bottom: 5px;"><strong>Subject:</strong> ${subjectInput.value || '[Subject]'}</p>
                    <p style="margin-bottom: 5px;"><strong>Week:</strong> ${weekNumberInput.value || '[Week]'}</p>
                    <p style="margin-bottom: 20px;"><strong>Date:</strong> ${date}</p>
                </div>
                <hr>
            `;
            
            html += `<h3>1. LEARNING</h3>`;
            html += `<div style="margin-bottom: 20px;">${parseCommands(learningTextarea.value) || 'No content...'}</div>`;
            
            html += `<h3>2. EQUIVALENCE & AWARENESS</h3>`;
            html += `<div style="margin-bottom: 20px;">${parseCommands(equivalenceTextarea.value) || 'No content...'}</div>`;
            
            html += `<h3>3. PRACTICE</h3>`;
            html += `<div style="margin-bottom: 20px;">${parseCommands(practiceTextarea.value) || 'No content...'}</div>`;
            
            html += `<h3>4. PERSONAL INSIGHT</h3>`;
            html += `<div style="margin-bottom: 20px;">${parseCommands(insightTextarea.value) || 'No content...'}</div>`;
            
            previewDiv.innerHTML = html;
        }

        // Function to load sample content
        function loadSampleContent() {
            if (confirm('This will replace your current content with sample data. Continue?')) {
                studentNameInput.value = 'Juan Dela Cruz';
                courseInput.value = 'BSCS 3';
                subjectInput.value = 'Database Management';
                weekNumberInput.value = 'Week 5';
                
                learningTextarea.value = `<h1>Database Normalization Concepts</h1>
This week, I learned about database normalization and its importance in reducing data redundancy. The process involves organizing data in a database to minimize duplication.

[TAB]I also explored different normal forms (1NF, 2NF, 3NF) and understood how each form addresses specific types of data anomalies.

<h3>Key Takeaways:</h3>
<ul>
<li><b>First Normal Form (1NF):</b> Eliminates duplicate columns</li>
<li><b>Second Normal Form (2NF):</b> Removes partial dependencies</li>
<li><b>Third Normal Form (3NF):</b> Eliminates transitive dependencies</li>
</ul>`;

                equivalenceTextarea.value = `<h2>Real-World Applications</h2>
Database normalization is widely used in enterprise systems. For example, e-commerce platforms use normalized databases to manage customer orders efficiently.

<ul>
<li>Large-scale systems like banking rely on normalized databases</li>
<li>Social media platforms use normalization for user relationships</li>
</ul>

<h3>Connection to Previous Lessons</h3>
This lesson connects directly to our previous discussions on SQL. The principles apply directly to the table structures we designed last week.`;

                practiceTextarea.value = `<h2>Practical Application</h2>
In my upcoming project, I can apply normalization principles when designing the database schema. This will help ensure that:

<ol>
<li>Data is consistent across tables</li>
<li>Updates are easier to manage</li>
<li>The database performs efficiently</li>
</ol>

<b>By properly normalizing</b>, I can create a more robust system. 

[TAB]This approach also makes it easier to write efficient SQL queries and implement features like data analytics or reporting in the future.`;

                insightTextarea.value = `<h2>Personal Reflection</h2>
I found the concept of <i>third normal form (3NF)</i> challenging at first because it requires careful analysis of functional dependencies. 

<blockquote>"The most challenging part was identifying transitive dependencies."</blockquote>

This week taught me that I learn best through practical examples rather than just theoretical explanations.

<hr>
<h3>Areas for Improvement</h3>
I need to improve my ability to identify normalization issues in existing database designs.`;
                
                updateWordCounts();
                generatePreview();
                showStatus('Sample content loaded successfully', 'success');
            }
        }

        // Event Listeners
        previewBtn.addEventListener('click', () => {
            updateWordCounts();
            generatePreview();
            showStatus('Preview updated', 'success');
        });
        
        clearBtn.addEventListener('click', () => {
            if(confirm('Are you sure you want to clear all fields?')) {
                studentNameInput.value = '';
                courseInput.value = '';
                subjectInput.value = '';
                weekNumberInput.value = '';
                learningTextarea.value = '';
                equivalenceTextarea.value = '';
                practiceTextarea.value = '';
                insightTextarea.value = '';
                updateWordCounts();
                generatePreview();
                showStatus('All fields cleared', 'warning');
            }
        });

        sampleBtn.addEventListener('click', loadSampleContent);

        // Export PDF Logic
        exportBtn.addEventListener('click', () => {
            const totalWords = updateWordCounts();
            if (totalWords < 300) {
                if(!confirm('Your word count is below the recommended 300 words. Do you still want to export?')) {
                    return;
                }
            }
            confirmationModal.style.display = 'flex';
        });

        modalCancel.addEventListener('click', () => {
            confirmationModal.style.display = 'none';
        });

        modalConfirm.addEventListener('click', () => {
            confirmationModal.style.display = 'none';
            loadingIndicator.style.display = 'block';
            
            // Small timeout to allow UI to update
            setTimeout(() => {
                try {
                    const doc = new jsPDF();
                    const date = new Date().toLocaleDateString();
                    
                    // Set font
                    doc.setFont("times", "normal");
                    doc.setFontSize(12);
                    
                    let yPos = 20;
                    const margin = 20;
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const contentWidth = pageWidth - (margin * 2);
                    
                    // Header
                    doc.setFont("times", "bold");
                    doc.setFontSize(14);
                    doc.text("LEAPP Reflection Report", pageWidth / 2, yPos, { align: "center" });
                    yPos += 15;
                    
                    // Student Info
                    doc.setFontSize(12);
                    doc.text(`Student Name: ${studentNameInput.value}`, margin, yPos);
                    yPos += 7;
                    doc.text(`Course: ${courseInput.value}`, margin, yPos);
                    yPos += 7;
                    doc.text(`Subject: ${subjectInput.value}`, margin, yPos);
                    yPos += 7;
                    doc.text(`Week: ${weekNumberInput.value}`, margin, yPos);
                    doc.text(`Date: ${date}`, pageWidth - margin - 30, yPos);
                    yPos += 15;
                    
                    // Helper to add sections
                    const addSection = (title, content) => {
                        // Check for page break
                        if (yPos > 250) {
                            doc.addPage();
                            yPos = 20;
                        }
                        
                        doc.setFont("times", "bold");
                        doc.text(title, margin, yPos);
                        yPos += 7;
                        
                        doc.setFont("times", "normal");
                        const cleanContent = cleanTextForPDF(content);
                        const splitText = doc.splitTextToSize(cleanContent, contentWidth);
                        
                        // Check if content fits
                        if (yPos + (splitText.length * 5) > 280) {
                            doc.addPage();
                            yPos = 20;
                        }
                        
                        doc.text(splitText, margin, yPos);
                        yPos += (splitText.length * 5) + 10;
                    };
                    
                    addSection("1. LEARNING", learningTextarea.value);
                    addSection("2. EQUIVALENCE & AWARENESS", equivalenceTextarea.value);
                    addSection("3. PRACTICE", practiceTextarea.value);
                    addSection("4. PERSONAL INSIGHT", insightTextarea.value);
                    
                    // Save
                    const filename = `LEAPP_Report_${studentNameInput.value.replace(/\s+/g, '_')}_${weekNumberInput.value.replace(/\s+/g, '_')}.pdf`;
                    doc.save(filename);
                    
                    loadingIndicator.style.display = 'none';
                    showStatus('PDF exported successfully!', 'success');
                } catch (error) {
                    console.error(error);
                    loadingIndicator.style.display = 'none';
                    showStatus('Error generating PDF. Check console.', 'error');
                }
            }, 100);
        });

        // Auto-update preview logic
        let typingTimer;
        function doneTyping() {
            clearTimeout(typingTimer);
            typingTimer = setTimeout(generatePreview, 1000);
            updateWordCounts();
        }
        
        learningTextarea.addEventListener('input', doneTyping);
        equivalenceTextarea.addEventListener('input', doneTyping);
        practiceTextarea.addEventListener('input', doneTyping);
        insightTextarea.addEventListener('input', doneTyping);
        
        // Initialize with sample content on load
        window.addEventListener('load', () => {
            // Optional: uncomment to load sample automatically
            // loadSampleContent(); 
            updateWordCounts();
        });
    </script>

</body>
</html>